<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500" viewBox="0 0 800 500">
  <defs>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4A90D9"/>
      <stop offset="100%" style="stop-color:#2E6AB3"/>
    </linearGradient>
    <linearGradient id="processGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F7C948"/>
      <stop offset="100%" style="stop-color:#E5A823"/>
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2ECC71"/>
      <stop offset="100%" style="stop-color:#27AE60"/>
    </linearGradient>
    <linearGradient id="dbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9B59B6"/>
      <stop offset="100%" style="stop-color:#7D3C98"/>
    </linearGradient>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2E6AB3"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#E5A823"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#27AE60"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9B59B6"/>
    </marker>
    <marker id="arrowGray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#888"/>
    </marker>
    <style>
      .animated-line { stroke-dasharray: 8 4; animation: flow 1.2s linear infinite; }
      @keyframes flow { to { stroke-dashoffset: -12; } }
    </style>
  </defs>

  <!-- ===== PHASE 1: Indexing (top) ===== -->
  <rect x="20" y="15" width="760" height="130" rx="10"
        fill="var(--color-surface-alt, #fafafa)" stroke="var(--color-border, #ddd)" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="40" y="38" text-anchor="start" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold"
        fill="var(--color-text-muted, #888)">INDEXING (offline)</text>

  <!-- Documents -->
  <rect x="50" y="60" width="100" height="65" rx="8" fill="url(#inputGrad)" stroke="#2E6AB3" stroke-width="2"/>
  <text x="100" y="83" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="22" fill="#ffffff">ğŸ“„</text>
  <text x="100" y="112" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Documents</text>

  <!-- Arrow: Docs â†’ Chunk -->
  <path d="M 150 92 L 185 92" stroke="#888" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Chunk -->
  <rect x="195" y="60" width="100" height="65" rx="8"
        fill="var(--color-surface, #E8F4FD)" stroke="#2E6AB3" stroke-width="1.5"/>
  <text x="245" y="83" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="22" fill="#2E6AB3">âœ‚ï¸</text>
  <text x="245" y="112" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E6AB3">Chunk</text>

  <!-- Arrow: Chunk â†’ Embed -->
  <path d="M 295 92 L 330 92" stroke="#888" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Embed -->
  <rect x="340" y="60" width="100" height="65" rx="8" fill="url(#processGrad)" stroke="#E5A823" stroke-width="2"/>
  <text x="390" y="83" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="22" fill="#ffffff">ğŸ”¢</text>
  <text x="390" y="112" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Embed</text>

  <!-- Arrow: Embed â†’ Vector Store -->
  <path d="M 440 92 L 490 92" stroke="#888" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Vector Store (cylinder) -->
  <g id="vector-store-index">
    <ellipse cx="570" cy="62" rx="60" ry="14" fill="url(#dbGrad)" stroke="#7D3C98" stroke-width="2"/>
    <rect x="510" y="62" width="120" height="55" fill="url(#dbGrad)"/>
    <ellipse cx="570" cy="117" rx="60" ry="14" fill="url(#dbGrad)" stroke="#7D3C98" stroke-width="2"/>
    <line x1="510" y1="62" x2="510" y2="117" stroke="#7D3C98" stroke-width="2"/>
    <line x1="630" y1="62" x2="630" y2="117" stroke="#7D3C98" stroke-width="2"/>
    <text x="570" y="84" text-anchor="middle" direction="ltr"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Vector</text>
    <text x="570" y="104" text-anchor="middle" direction="ltr"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Store</text>
  </g>

  <!-- ===== PHASE 2: Query (bottom) ===== -->
  <rect x="20" y="165" width="760" height="320" rx="10"
        fill="var(--color-surface-alt, #fafafa)" stroke="var(--color-border, #ddd)" stroke-width="1"/>
  <text x="40" y="188" text-anchor="start" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold"
        fill="var(--color-text-muted, #888)">QUERY (runtime)</text>

  <!-- User Query -->
  <rect x="50" y="220" width="110" height="65" rx="8" fill="url(#inputGrad)" stroke="#2E6AB3" stroke-width="2"/>
  <text x="105" y="243" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="22" fill="#ffffff">â“</text>
  <text x="105" y="272" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#ffffff">User Query</text>

  <!-- Arrow: Query â†’ Embed -->
  <path d="M 160 252 L 195 252" stroke="#2E6AB3" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>

  <!-- Embed (query) -->
  <rect x="205" y="220" width="100" height="65" rx="8" fill="url(#processGrad)" stroke="#E5A823" stroke-width="2"/>
  <text x="255" y="243" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="22" fill="#ffffff">ğŸ”¢</text>
  <text x="255" y="272" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Embed</text>

  <!-- Arrow: Embed â†’ Vector Store (similarity search) -->
  <path d="M 305 252 L 500 252" stroke="#9B59B6" stroke-width="2" fill="none" marker-end="url(#arrowPurple)" class="animated-line"/>
  <text x="400" y="240" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="12" fill="var(--color-text-muted, #666)">similarity search</text>

  <!-- Vector Store (query phase) -->
  <g id="vector-store-query">
    <ellipse cx="570" cy="222" rx="60" ry="14" fill="url(#dbGrad)" stroke="#7D3C98" stroke-width="2"/>
    <rect x="510" y="222" width="120" height="55" fill="url(#dbGrad)"/>
    <ellipse cx="570" cy="277" rx="60" ry="14" fill="url(#dbGrad)" stroke="#7D3C98" stroke-width="2"/>
    <line x1="510" y1="222" x2="510" y2="277" stroke="#7D3C98" stroke-width="2"/>
    <line x1="630" y1="222" x2="630" y2="277" stroke="#7D3C98" stroke-width="2"/>
    <text x="570" y="244" text-anchor="middle" direction="ltr"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Vector</text>
    <text x="570" y="264" text-anchor="middle" direction="ltr"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">Store</text>
    <text x="570" y="300" text-anchor="middle" direction="ltr"
          font-family="Arial, sans-serif" font-size="14" fill="var(--color-text-muted, #666)">ğŸ”</text>
  </g>

  <!-- Dashed line connecting the two Vector Stores -->
  <line x1="570" y1="131" x2="570" y2="208" stroke="#9B59B6" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- Arrow: Vector Store â†’ Retrieved Chunks -->
  <path d="M 570 314 L 570 340" stroke="#9B59B6" stroke-width="2" fill="none" marker-end="url(#arrowPurple)"/>

  <!-- Retrieved Chunks -->
  <rect x="490" y="350" width="160" height="50" rx="8"
        fill="var(--color-surface, #F3E8FF)" stroke="#9B59B6" stroke-width="1.5"/>
  <text x="570" y="371" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7D3C98">Retrieved Chunks</text>
  <text x="570" y="391" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="12" fill="var(--color-text-muted, #666)">top-k relevant</text>

  <!-- Arrow: Query also goes down to LLM -->
  <path d="M 105 285 L 105 375 L 200 375" stroke="#2E6AB3" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>

  <!-- Arrow: Chunks â†’ LLM -->
  <path d="M 490 375 L 410 375" stroke="#9B59B6" stroke-width="2" fill="none" marker-end="url(#arrowPurple)"/>

  <!-- LLM -->
  <rect x="210" y="335" width="190" height="80" rx="12" fill="url(#outputGrad)" stroke="#27AE60" stroke-width="2.5"/>
  <text x="305" y="363" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="26" fill="#ffffff">ğŸ§ </text>
  <text x="305" y="390" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#ffffff">LLM</text>
  <text x="305" y="408" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="12" fill="#ffffff">query + context â†’ answer</text>

  <!-- Arrow: LLM â†’ Response -->
  <path d="M 305 415 L 305 440" stroke="#27AE60" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>

  <!-- Response -->
  <rect x="225" y="448" width="160" height="32" rx="6" fill="url(#outputGrad)" stroke="#27AE60" stroke-width="1.5"/>
  <text x="305" y="470" text-anchor="middle" direction="ltr"
        font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff">âœ… Grounded Answer</text>
</svg>
